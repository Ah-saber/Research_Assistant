# /note-organize - 整理和重新组织笔记

## 触发词
- "整理笔记"
- "优化笔记"
- "重组笔记"
- "笔记整理"

## 功能描述
根据分析结果，整理和优化笔记结构，包括标签规范化、建立链接、合并重复笔记等。

## 整理功能

### 1. 标签规范化
- 统一标签格式为层级结构：`#一级/二级/三级`
- 识别并合并同义标签
- 删除冗余标签
- 添加缺失标签

### 2. 建立链接
- 根据语义分析创建链接
- 为孤立笔记建立连接
- 添加上下文相关链接
- 创建索引笔记（**必须使用表格格式**，参考`PLAN/references/索引笔记参考.md`）

### 3. 合并笔记
- 识别内容基本一致的笔记
- 提出合并建议
- 智能合并内容
- 保留历史记录

### 4. 目录整理
- 优化目录结构
- 移动错位的笔记
- 创建目录索引
- 统一命名规范

## 执行模式

**建议优先**
1. 分析现有笔记
2. 提出整理方案
3. 列出所有变更
4. 等待用户确认（使用AskUserQuestion）
5. 执行整理操作

**操作类型**
- 安全操作：自动执行（标签格式化）
- 需确认：合并笔记、移动笔记（使用AskUserQuestion）
- 需审核：删除内容（使用AskUserQuestion）

### 交互流程（重要）

提出整理方案后，**必须**使用AskUserQuestion让用户选择：

```markdown
## 整理方案概览
- 标签规范化：15个
- 建议链接：8对
- 建议合并：2组
- 目录调整：3个

使用AskUserQuestion询问用户：
1. 全部执行
2. 部分执行（可选择标签规范化、建立链接等）
3. 仅预览（dry_run模式）
4. 取消
```

## 整理方案格式

```markdown
# 笔记整理方案

## 标签规范化
- `#深度学习` → `#科研/深度学习`
- `#DL` → `#科研/深度学习`
- `#transformer` → `#科研/深度学习/Transformer`

## 建议链接
- 《Transformer架构》 ←→ 《自注意力机制》
- 《梯度下降》 ←→ 《优化算法》

## 建议合并
- 《注意力机制》 + 《Attention机制》 → 《注意力机制》
  原因：内容重复度95%

## 目录调整
- 移动《PyTorch入门》→ 工具/编程/Python/

## 确认执行？
1. 全部执行
2. 选择性执行
3. 取消
```

## 输入参数

| 参数 | 说明 | 必填 |
|------|------|------|
| scope | 整理范围 | 否，默认全部 |
| dry_run | 仅预览不执行 | 否，默认true |
| focus | 重点关注 | 否 |

## 整理规则

### 标签规范
```yaml
层级格式: "#一级/二级/三级"
大小写: 首字母大写
分隔符: 使用"/"
同义词: 统一使用标准术语
```

### 链接规范
```yaml
格式: "[[笔记名称]]"
带描述: "[[笔记名称|描述]]"
表格中: "[[笔记名称\|描述]]"  ← 表格中必须转义管道符
位置: 相关段落或文末
数量: 适度链接，不过度
```

### 合并规则
```yaml
相似度阈值: 85%以上
保留策略: 保留更完整的版本
历史记录: 添加合并记录
frontmatter: 追加merged_from字段
```

## 安全措施

1. **备份提醒**：执行前提醒用户备份
2. **预览模式**：默认dry_run，确认后执行
3. **撤销方案**：提供撤销操作的建议
4. **分步确认**：每个大类操作需单独确认

## 工作流程

```
1. /note-analyze 分析笔记
2. 生成整理方案
3. 用户审核方案
4. 确认执行范围
5. 执行整理操作
6. 生成整理报告
```

## 示例

```bash
用户: /note-organize

你: 基于之前的分析，生成整理方案：

## 整理方案概览
- 标签规范化：15个
- 建议链接：8对
- 建议合并：2组
- 目录调整：3个

## 详细方案
[显示详细方案]

请选择：
1. 全部执行
2. 部分执行（指定）
3. 仅执行标签规范化
4. 取消

用户: 3

你: 执行标签规范化...
✓ 完成 15/15

整理完成！查看详情：[整理报告]
```

## 后续操作

整理完成后建议：
- `/note-link` - 进一步建立关联
- `/note-analyze` - 重新分析验证
- 检查整理效果

---

## 论文目录整理（专项）

当用户要求整理论文密集型目录（如 `Paper/`）时，使用以下专用流程：

### 触发条件
- 用户明确指定"论文目录"、"Paper文件夹"
- 目录中包含大量论文笔记（>10篇）
- 笔记标题为论文名

### 工作流程

```
分析论文 → 创建索引 → 主题概览 → 建立链接 → Idea捕获 → 移动汇总
```

### 输出文件

1. **汇总索引**（`00_论文索引_[主题].md`）
   - 按研究方法分类
   - 概率框架分析
   - 交叉关联

2. **主题概览**（`主题_[名称].md`）
   - 概率视角分析
   - 方法对比
   - 理论延伸

3. **Idea笔记**（保存到 `Inspiration/`）
   - 理论动机
   - 可行性评估
   - 下一步方向

### 重要约定

**汇总文件必须移动到 `Conclusion/` 目录**：
```bash
mv Paper/00_论文索引_*.md Conclusion/
mv Paper/主题_*.md Conclusion/
```

### 参考案例

2026-01-27 `科研/CV/Generate/Paper/` 整理：
- 17篇论文分类
- 3个主题概览
- 4个Idea捕获
- 汇总移至 `Conclusion/`

详见工作流文档：`docs/workflows/note-organization.md`

---

## ⚠️ 关键注意事项（必须遵守）

### 1. 为论文添加YAML frontmatter

**每次整理论文目录时，必须为每篇论文添加统一的frontmatter**：

```yaml
---
title: 论文完整标题（与文件名一致）
tags:
  - CV
  - Diffusion
  - CVPR
  - train-free
category: 图像编辑/图像恢复/逆问题/采样加速/Flow模型
created: YYYY-MM-DD
---
```

**原因**：统一的元数据格式便于后续管理和筛选。

### 2. 链接必须使用完整文件名

**Obsidian Wikilink的严格要求**：

❌ **错误**：`[[FlowEdit]]`
✅ **正确**：`[[FlowEdit：Inversion-Free Text-Based Editing Using Pre-Trained Flow Models\|FlowEdit]]`

**规则**：
- 链接目标必须是**完整的文件名**
- 使用管道符号`|`添加显示别名
- 在汇总和主题笔记中创建链接时必须遵循此规则

### 3. 链接创建流程

1. **获取完整文件名**：使用`ls`或`Glob`工具获取论文的完整文件名
2. **创建带别名的链接**：`[[完整文件名|简短名称]]`
3. **验证链接**：在创建后确认链接可点击

### 4. 常见错误

| 错误 | 后果 | 正确做法 |
|------|------|----------|
| 使用简短名称 | 链接失效 | 使用完整文件名 |
| 忘记添加frontmatter | 难以管理 | 统一添加元数据 |
| 链接到错误路径 | 404错误 | 仔细核对文件名 |

---

## 注意事项

- 不破坏用户现有内容
- 不删除用户原始数据
- 保留操作记录
- 可逆操作优先

## 与 obsidian-markdown 的关系

**分工明确**：
- **obsidian-markdown**：提供 Obsidian 格式语法参考文档
  - Frontmatter、Wikilink、标签、表格的语法规范
- **/note-organize**：提供整理工作流
  - 生成整理方案 → 用户确认 → 执行整理操作

**不是重复造轮子**：
- obsidian-markdown 是**文档技能**，不执行文件操作
- 本技能是**工作流封装**，使用 Read/Write/Edit + Glob 执行文件修改
- 两者是**参考与执行**的关系

**使用的Obsidian特性**：
- Frontmatter：补全和规范化元数据
- Wikilink：使用Glob精确匹配文件名创建链接
- 标签：规范化为层级格式（#一级/二级/三级）
- 表格：索引笔记使用表格格式
