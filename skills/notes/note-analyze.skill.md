# /note-analyze - 分析笔记结构和内容

## 触发词
- "分析笔记"
- "笔记结构分析"
- "分析笔记库"
- "检查笔记状态"

## 功能描述
分析Obsidian笔记库的结构和内容，发现笔记之间的联系、孤立笔记、重复内容等。

## 分析维度

### 1. 结构分析
- 笔记数量统计
- 目录结构分析
- 嵌套深度分析
- 孤立目录识别

### 2. 链接分析
- 孤立笔记（没有入链/出链）
- 热门笔记（被引用最多）
- 链接密度分析
- 断链检测

### 3. 标签分析
- 标签使用统计
- 标签层级结构
- 未规范标签识别
- 标签聚类

### 4. 语义分析（核心重点）
- 发现相似相同的思考和用法
- 分析是否有相同的本质或同一主题
- 主题关联分析
- 相似概念识别
- 内容聚类分析

### 5. 内容分析
- 笔记长度分布
- Frontmatter完整性
- 重复内容检测
- 待办事项统计

## 分析范围

| 选项 | 说明 |
|------|------|
| 全部 | 分析整个Obsidian库 |
| 目录 | 分析指定目录 |
| 标签 | 分析带指定标签的笔记 |
| 深度 | 快速/完整/深度分析 |

## 输出格式

```markdown
# 笔记分析报告

## 概览
- 笔记总数：234篇
- 目录数：12个
- 标签数：45个

## 结构分析
...
## 链接分析
...
## 标签分析
...
## 语义分析（重点）
### 相似内容发现
- 笔记A和笔记B讨论了相同的主题：注意力机制
- 建议：可以合并或建立链接

### 主题关联
- 深度学习、神经网络、反向传播形成主题簇

### 相似概念
- "Transformer"和"自注意力模型"指代相同概念
...
## 改进建议
1. 合并重复笔记X和Y
2. 为孤立笔记Z建立链接
3. 规范化标签格式
```

## 输入参数

| 参数 | 说明 | 必填 |
|------|------|------|
| scope | 分析范围 | 否，默认全部 |
| depth | 分析深度 | 否，默认标准 |
| focus | 重点关注 | 否 |

## 语义分析方法

### 相似性检测
- 使用关键词共现分析
- 检测相同主题的不同表述
- 发现概念同义词

### 本质分析
- 识别笔记的核心观点
- 比较观点的异同
- 发现思想脉络

### 主题建模
- 自动发现主题簇
- 识别跨目录关联
- 推荐潜在链接

## 工作流程

### 完整分析流程

```
1. 确定分析范围
2. 扫描笔记文件
3. 分析结构和内容
4. 生成分析报告
5. 询问用户是否执行改进建议 ← 新增
6. 根据用户选择执行操作
```

### 交互流程（重要）

分析完成后，**必须**使用AskUserQuestion询问用户是否要执行改进建议：

```markdown
## 改进建议
1. 添加Frontmatter到主要笔记
2. 建立索引笔记
3. 增加链接
4. 规范化标签
5. 标准化笔记格式（调用 /note-standardize）
6. 生成可视化图谱（新增）← 调用 /paper-graph、/idea-map、/knowledge-canvas

使用AskUserQuestion询问用户：
- 是否要执行这些建议？
- 允许多选
- 提供"暂不执行"选项
```

### 执行改进操作

根据用户选择执行对应操作：
- **添加Frontmatter**：为主要笔记添加title、type、tags、date、related等元数据
- **建立索引笔记**：为主题簇创建索引笔记，使用`00-索引.md`命名
- **增加链接**：在相关笔记间建立Wikilink
- **规范化标签**：统一标签格式为层级结构
- **标准化笔记格式**：调用 `/note-standardize` 进行格式标准化
  - Callout格式化
  - Wikilink修复
  - Frontmatter补全
  - 标签规范化
  - Embeds引用
- **生成可视化图谱**：调用Visualization Skills创建Canvas可视化
  - `/paper-graph` - 论文引用关系图谱（层次布局）
  - `/idea-map` - Idea概念关系图谱（力导向布局）
  - `/knowledge-canvas` - 综合知识画布（区域布局）
  - 这些技能参考 **json-canvas** 格式规范，使用 Read/Write/Edit + Glob 执行

## 示例

```bash
用户: /note-analyze 深度学习相关笔记

你: 正在分析深度学习相关笔记...

✓ 扫描89篇笔记
✓ 分析链接关系
✓ 语义聚类分析

## 语义分析发现

### 相似思考
《Transformer架构.md》和《自注意力机制.md》讨论了相同的本质：
- 核心都是attention mechanism
- 建议合并或建立强关联

### 主题簇
发现以下笔记形成"注意力机制"主题簇：
- Transformer架构.md
- 自注意力机制.md
- 多头注意力.md
- 注意力可视化.md

建议：创建主题索引笔记

### 改进建议
...
```

## 注意事项

- 尊重现有笔记结构
- 不破坏现有内容
- 建议需用户确认后执行
- 分析耗时可能较长

## 与 obsidian-markdown 的关系

**分工明确**：
- **obsidian-markdown**：提供 Obsidian 格式语法参考文档
  - Frontmatter、Wikilink、标签的语法规范
- **/note-analyze**：提供分析工作流
  - 分析笔记结构 → 检测格式问题 → 生成改进建议
  - 可调用 `/note-standardize` 执行格式标准化

**不是重复造轮子**：
- obsidian-markdown 是**文档技能**，不执行文件操作
- 本技能是**工作流封装**，使用 Read/Write/Edit + Glob 扫描和分析
- 两者是**参考与执行**的关系

**使用的Obsidian特性**：
- Frontmatter：分析笔记元数据完整性
- Wikilink：分析笔记链接关系
- 标签：分析标签使用情况
- 表格：索引笔记使用表格格式（参考`索引笔记参考.md`）

## 与 Canvas 可视化的关系

**三层协作架构**：

| 层级 | 组件 | 作用 |
|------|------|------|
| **格式参考** | json-canvas skill | 提供 Canvas (.canvas) 格式规范文档 |
| **执行工具** | Read/Write/Edit + Glob | 底层文件操作 |
| **工作流封装** | /paper-graph 等 | 业务逻辑 |

**分工明确**：
- **json-canvas**：提供 Canvas 格式规范文档
  - 节点类型（file、text、group）、边类型、布局算法
- **Visualization Skills**：提供可视化工作流
  - /paper-graph、/idea-map、/knowledge-canvas
- **/note-analyze**：发现可视化需求，建议调用对应技能

**不是重复造轮子**：
- json-canvas 是**文档技能**，不执行文件操作
- Visualization Skills 是**工作流封装**，使用 Read/Write/Edit + Glob 创建Canvas文件
- 本技能是**分析层**，识别需要可视化的内容并建议调用对应技能

**可视化建议触发条件**：
- 发现论文引用关系 → 建议调用 `/paper-graph`
- 发现Idea概念关联 → 建议调用 `/idea-map`
- 发现综合研究主题 → 建议调用 `/knowledge-canvas`
