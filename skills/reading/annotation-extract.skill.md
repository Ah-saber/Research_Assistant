# /annotation-extract - 提取PDF注释

## 触发词
- "提取注释"
- "获取高亮"
- "导出笔记"
- "提取PDF注释"

## 功能描述
从Zotero中提取PDF的高亮和笔记，按颜色分组组织，输出为可导入Obsidian的格式。

## 提取内容

### 1. 高亮文本
- 高亮文本内容
- 页码位置
- 上下文信息

### 2. 笔记注释
- 用户添加的笔记
- 对应的高亮
- 标签信息

### 3. 颜色分组
- 黄色：重要概念
- 绿色：方法细节
- 蓝色：实验结果
- 红色：疑问/待研究
- 其他：按颜色分类

## 输出格式

```markdown
# [论文标题] - PDF注释

## 黄色 - 重要概念

### Page 23
> "Transformer架构的核心是自注意力机制..."

[笔记] 这是论文的核心贡献

---

## 绿色 - 方法细节

### Page 45
> "我们使用多头注意力机制..."

---

## 蓝色 - 实验结果

...

## 红色 - 疑问/待研究

...
```

## 输入参数

| 参数 | 说明 | 必填 |
|------|------|------|
| paper | 论文（标题/ID/Zotero key） | 是 |
| group_by | 分组方式（color/page） | 否，默认color |

## 后续操作

提取后询问用户：
- 是否创建为独立笔记
- 是否附加到现有笔记
- 是否需要整理和分类

## 使用的Zotero MCP工具

- `zotero_get_annotations` - 获取PDF注释

## 注意事项

- 保留原文语言（通常英文）
- 中文组织结构
- 包含准确的页码引用

## MCP工具使用注意事项

### 空注释处理
当论文没有注释时：
1. `zotero_get_annotations` 返回 "No annotations found"
2. 友好提示用户：该论文暂无PDF注释
3. 建议用户：
   - 在Zotero Reader中添加高亮/笔记
   - 或者提供其他有注释的论文

### 大量数据处理
当获取所有注释时数据量可能巨大（60万+字符）：
1. **按论文筛选**: 使用 `item_key` 参数获取单篇论文的注释
2. **使用limit**: 设置合理的返回数量
3. **分批处理**: 如果需要全部注释，建议分批次处理

### 推荐工作流
```bash
# 1. 先检查论文是否有注释
zotero_get_annotations(item_key="XXX")

# 2. 如果有注释则提取，无则提示
# 3. 输出按颜色分组的markdown格式
```

### 降级策略
- 如果单篇论文无注释：提示用户添加注释
- 如果需要批量提取：建议按collection或tag分批处理
