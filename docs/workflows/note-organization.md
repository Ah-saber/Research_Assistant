# 笔记整理工作流

本文档描述使用Research Assistant整理和优化Obsidian笔记的工作流程。

## 工作流概览

```
分析笔记 → 发现问题 → 制定方案 → 执行整理 → 验证效果
```

## 详细步骤

### 1. 分析笔记

使用 `/note-analyze` 全面分析笔记结构和内容。

```bash
/note-analyze
```

**分析内容**：
- 笔记数量统计
- 目录结构分析
- 孤立笔记检测
- 链接关系分析
- 标签使用情况
- **语义分析**（重点）

**输出**：分析报告，包含：
- 结构问题
- 链接问题
- 标签问题
- 相似内容发现
- 改进建议

### 2. 制定整理方案

基于分析报告，使用 `/note-organize` 生成整理方案。

```bash
/note-organize
```

**方案内容**：
- 标签规范化建议
- 链接建立建议
- 笔记合并建议
- 目录调整建议

**预览模式**（默认）：
- 显示所有变更
- 不实际执行
- 等待用户确认

### 3. 执行整理

确认方案后，执行整理操作。

```bash
用户: 全部执行
你: 执行整理...
✓ 标签规范化：15个
✓ 建立链接：8对
✓ 合并笔记：2组
```

### 4. 建立关联

使用 `/note-link` 进一步建立笔记之间的关联。

```bash
/note-link "Transformer架构"
```

**功能**：
- 发现语义相关的笔记
- 建议链接位置
- 添加描述性链接

### 5. 验证效果

重新运行分析，验证整理效果。

```bash
/note-analyze

对比整理前后的指标：
- 孤立笔记：20 → 5
- 标签规范率：60% → 95%
- 链接密度：低 → 中
```

## 完整示例

```
用户: /note-analyze

你: # 笔记分析报告

## 概览
- 笔记总数：234篇
- 孤立笔记：20篇
- 目录数：12个

## 语义分析发现

### 相似内容
《Transformer架构》和《自注意力机制》讨论相同本质：
- 核心都是attention mechanism
- 建议合并或建立强关联

### 主题簇
发现"注意力机制"主题簇：
- Transformer架构
- 自注意力机制
- 多头注意力
- 注意力可视化

## 改进建议
1. 合并重复笔记2组
2. 为孤立笔记建立链接
3. 规范化标签格式

用户: /note-organize

你: # 笔记整理方案

## 标签规范化
- `#深度学习` → `#科研/深度学习`
- `#DL` → `#科研/深度学习`

## 建议链接
- Transformer架构 ←→ 自注意力机制
- 梯度下降 ←→ 优化算法

## 建议合并
- 注意力机制 + Attention机制 → 注意力机制

确认执行？
1. 全部执行
2. 选择性执行
3. 取消

用户: 1

你: 执行整理...
✓ 完成 25/25 项操作

用户: /note-analyze

你: # 整理后分析报告

- 孤立笔记：20 → 5
- 标签规范率：60% → 95%
- 整理完成！
```

## 快速整理

### 仅整理标签

```bash
/note-organize
# 选择"仅整理标签"选项
```

### 仅建立链接

```bash
/note-link
# 选择"自动添加"选项
```

### 仅合并重复

```bash
/note-organize --focus duplicate
```

## 高级用法

### 指定范围整理

```bash
# 整理特定目录
/note-organize --scope "深度学习"

# 整理特定标签
/note-organize --tag "论文"
```

### 批量建立链接

```bash
# 为整个目录建立链接
/note-link --scope "深度学习" --auto_add

这会：
1. 分析目录中所有笔记
2. 发现语义关联
3. 自动添加链接
```

### 创建主题索引

```bash
/note-template --type index --theme "注意力机制"

然后使用/note-link将相关笔记链接到索引
```

---

## 论文目录整理

当需要整理论文密集型目录（如 `Paper/`）时，使用以下工作流：

### 工作流步骤

```
分析论文 → 创建索引 → 主题概览 → 建立链接 → Idea捕获
```

### 1. 论文分析

读取目录中所有论文笔记，分析：
- 论文数量统计
- 研究方法分类
- 标签使用情况
- 内容结构分析

### 2. 创建汇总索引

**文件位置**：在源目录创建 `00_论文索引_[主题].md`

**内容结构**：
- 分类概览表格（类别 | 数量 | 核心主题）
- 按方法分类的论文列表
- 每篇论文的关键创新和概率框架分析
- 主题交叉关联
- 研究趋势总结

**示例**：
```markdown
# 扩散与流模型论文索引

## 📊 分类概览
| 类别 | 数量 | 核心主题 |
|------|------|----------|
| Flow Models | 2 | Rectified Flow |
| 图像编辑 | 3 | Cross-Attention Control |

## 🌊 Flow Models (2篇)
| 论文 | 关键创新 | 概率框架 |
...
```

### 3. 创建主题概览

为关键研究主题创建深度分析笔记：

**文件命名**：`主题_[主题名].md`

**内容结构**：
- 主题概览表格
- 概率框架视角分析
- 方法详解（核心公式、设计逻辑）
- 方法对比
- 理论分析
- 可能的延伸方向

**示例主题**：
- 频域方法在扩散模型中的应用
- 注意力控制在图像编辑中的应用
- 盲逆问题的扩散模型求解

### 4. 建立论文间链接

在相关论文笔记末尾添加"相关研究"部分：

```markdown
---

## 相关研究

- 频域方法：[[论文A]]、[[论文B]]
- 主题笔记：[[主题_频域方法]]
```

**链接策略**：
- Flow模型 ↔ 图像编辑
- 频域方法 ↔ 主题笔记
- 盲逆问题 ↔ 主题笔记

### 5. Idea捕获

从论文中提取潜在研究方向，保存到 `科研/Inspiration/`：

**Idea笔记结构**：
```markdown
# Idea: [标题]

## 理论动机
- 数学基础
- 问题的概率结构

## 可行性评估
- 理论可行性
- 潜在理论障碍

## 跨领域关联
- NLP方法迁移
- 物理类比
- 优化理论

## 问题本质
- 核心科学问题
- 与经典问题的联系

## 下一步
- 理论推导方向
- 验证思路
```

### 6. 移动汇总文件

**重要约定**：汇总索引和主题概览应移动到 `科研/CV/Conclusion/` 目录

**原因**：
- `Conclusion/` 用于存放总结性、概括性内容
- `Paper/` 保持为原始论文笔记的存储位置
- 便于后续查找和回顾

**操作**：
```bash
# 移动汇总文件
mv Paper/00_论文索引_*.md Conclusion/
mv Paper/主题_*.md Conclusion/
```

### 实际案例

2026-01-27 的 `科研/CV/Generate/Paper/` 整理：

| 输出文件 | 类型 | 位置 |
|----------|------|------|
| `00_论文索引_扩散与流模型.md` | 索引 | `Conclusion/` |
| `主题_频域方法在扩散模型中的应用.md` | 主题 | `Conclusion/` |
| `主题_注意力控制在图像编辑中的应用.md` | 主题 | `Conclusion/` |
| `主题_盲逆问题的扩散模型求解.md` | 主题 | `Conclusion/` |
| `Idea_小波引导的多尺度扩散模型.md` | Idea | `Inspiration/` |

**成果**：
- 17篇论文分类整理
- 3个主题深度分析
- 4个潜在研究方向捕获
- 10篇论文建立链接

---

## ⚠️ 常见问题与解决方案

### 问题1：论文笔记缺少YAML frontmatter

**症状**：
- 论文笔记没有统一的元数据格式
- 难以通过标签筛选和管理

**解决方案**：
为每篇论文添加统一的YAML frontmatter：

```yaml
---
title: 论文完整标题
tags:
  - CV
  - Diffusion
  - CVPR
  - train-free
category: 图像编辑/图像恢复/逆问题/采样加速/Flow模型
created: YYYY-MM-DD
---
```

**执行步骤**：
1. 读取论文文件
2. 在文件开头添加frontmatter
3. 确保title字段与论文标题一致

### 问题2：汇总索引中的链接无法点击

**症状**：
- 汇总笔记中的链接显示为红色或无法点击
- 点击链接后显示"文件不存在"

**根本原因**：
Obsidian的Wikilink必须使用**完整的文件名**。使用简短名称（如`[[FlowEdit]]`）会导致链接失效。

**错误示例**：
```markdown
| 论文 | 关键创新 |
|------|----------|
| [[FlowEdit]] | Inversion-Free |
| [[FreeMA]] | 频域采样 |
```

**正确做法**：使用完整文件名+别名
```markdown
| 论文 | 关键创新 |
|------|----------|
| [[FlowEdit：Inversion-Free Text-Based Editing Using Pre-Trained Flow Models\|FlowEdit]] | Inversion-Free |
| [[Boosting Diffusion Models with Moving Average Sampling in Frequency Domain\|FreeMA]] | 频域采样 |
```

**语法说明**：
- `[[完整文件名]]` — 完整链接
- `[[完整文件名|显示名称]]` — 带别名的链接（推荐）
- `[[完整文件名#标题]]` — 链接到特定章节

### 问题3：批量修正链接的方法

当需要修正大量链接时：

1. **建立映射表**：简短名称 → 完整文件名
2. **使用Write工具**重写整个文件
3. **全局替换**：使用`replace_all`参数

**示例**：
```python
# 映射表
mapping = {
    "FlowEdit": "FlowEdit：Inversion-Free Text-Based Editing Using Pre-Trained Flow Models",
    "FreeMA": "Boosting Diffusion Models with Moving Average Sampling in Frequency Domain",
    # ...
}

# 替换链接
for short_name, full_name in mapping.items():
    old_link = f"[[{short_name}]]"
    new_link = f"[[{full_name}\\|{short_name}]]"
    content = content.replace(old_link, new_link)
```

### 问题4：链接修正的验证方法

修正完成后，验证链接是否有效：

1. **在Obsidian中打开汇总文件**
2. **逐个点击链接**，确认能跳转到对应论文
3. **检查反向链接**（在论文中查看"Backlinks"面板）

### 问题5：文件名空格不一致导致链接失效

**症状**：
- 链接看起来正确，但点击后显示"文件不存在"
- 文件名包含**双空格**，但链接中使用的是**单空格**

**根本原因**：
Obsidian的Wikilink必须**精确匹配文件名**，包括空格数量。某些论文从PDF导入时可能产生双空格。

**错误示例**：
```markdown
# 索引笔记中的链接
[[PROMPT-TO-PROMPT IMAGE EDITING WITH CROSS-ATTENTION CONTROL]]

# 实际文件名
PROMPT-TO-PROMPT IMAGE EDITING  WITH CROSS-ATTENTION CONTROL.md
#                                      ↑ 双空格              ↑ 双空格
```

**解决方案**：

1. **检查实际文件名**：使用Glob工具精确获取文件名
2. **使用完整文件名创建链接**：包括所有空格和特殊字符
3. **验证链接**：创建后检查链接是否可点击

**创建索引笔记的最佳实践**：
```markdown
# 正确工作流

1. 先列出Paper目录中的所有.md文件
2. 对每个文件，使用精确的文件名创建链接
3. 使用别名语法缩短显示名称：
   [[完整文件名|显示名称]]
```

**示例代码**：
```python
# 错误：假设文件名格式
link = f"[[{paper_title}]]"

# 正确：使用实际文件名
actual_filename = get_filename_from_directory(paper_title)
link = f"[[{actual_filename}|{paper_title}]]"
```

---

## 整理原则与最佳实践

### 核心原则

**最小化变动**
- 仅做必要的修改
- 保留用户原有风格
- 不破坏有价值的内容

**渐进式整理**
- 分批执行
- 每次验证效果
- 支持撤销调整

**用户控制**
- 所有变更需确认
- 提供预览模式
- 保留操作记录

### 最佳实践

1. **先分析后整理**：充分了解笔记现状再制定方案
2. **分步执行**：不要一次性大改，分类型逐步整理
3. **定期整理**：每月一次小整理，每季度一次大整理
4. **备份重要**：整理前备份Obsidian vault
5. **保留记录**：记录整理操作，便于追溯

## 相关技能

- `/note-analyze` - 分析笔记
- `/note-organize` - 整理笔记
- `/note-link` - 建立关联
- `/note-template` - 创建模板
